# 📱 水質調査データメモアプリ（スマホ対応版）

フィールドワーク用オフライン対応水質調査データ記録PWA（Progressive Web App）

## 🚀 **スマホでのクイックスタート**

### 📲 **方法1: 同一Wi-Fi経由でアクセス（推奨）**

#### 1. パソコンでサーバー起動
```bash
cd water-quality-app
python3 -m http.server 8000
```

#### 2. IPアドレスを確認
```bash
# Macの場合
ifconfig | grep "inet " | grep -v 127.0.0.1

# Windowsの場合
ipconfig | findstr "IPv4"
```

#### 3. スマホでアクセス
- スマホのブラウザで `http://[あなたのIPアドレス]:8000` にアクセス
- 例: `http://192.168.1.100:8000`

### 📲 **方法2: ngrok使用（外出先から）**

#### 1. ngrokインストール
```bash
# Homebrewの場合（Mac）
brew install ngrok

# 直接ダウンロード
# https://ngrok.com/download
```

#### 2. ngrok起動
```bash
cd water-quality-app
python3 -m http.server 8000 &
ngrok http 8000
```

#### 3. 表示されたHTTPS URLでアクセス
```
例: https://abc123.ngrok.io
```

## 📱 **スマホ対応機能**

### ✨ **新機能・改善点**

#### 🎯 **タッチ操作最適化**
- **大きなボタン**: 指での操作に最適化された56px以上のボタン
- **スワイプナビゲーション**: 左右スワイプでタブ切り替え
- **ダブルタップズーム防止**: 誤操作を防ぐ設定
- **長押し防止**: コンテキストメニューの表示を制御

#### 📲 **PWAインストール機能**
- **ワンタップインストール**: アプリ化してホーム画面に追加
- **オフライン動作**: ネイティブアプリのような動作
- **自動更新**: 新バージョンの自動通知

#### 🌐 **GPS機能強化**
- **高精度位置取得**: `enableHighAccuracy: true`
- **バッテリー最適化**: バックグラウンド時のGPS停止
- **精度表示**: 取得した位置の精度をメートル単位で表示

#### 🔋 **バッテリー管理**
- **自動節約モード**: バッテリー残量20%以下で機能制限
- **バックグラウンド最適化**: 非表示時の処理停止
- **効率的同期**: 必要時のみデータ同期実行

#### 🎨 **レスポンシブデザイン**
- **ダークモード対応**: システム設定に自動追従
- **高コントラストモード**: 屋外での視認性向上
- **セーフエリア対応**: iPhone Xシリーズのノッチ対応

## 📋 **PWAインストール手順**

### 🤖 **Android（Chrome/Edge）**

#### 1. ブラウザでアクセス
- Chrome または Edge でアプリにアクセス

#### 2. インストール通知
- 上部に「アプリをインストール」バナーが表示
- 「インストール」ボタンをタップ

#### 3. 手動インストール
バナーが表示されない場合：
1. ブラウザのメニュー（⋮）をタップ
2. 「アプリをインストール」または「ホーム画面に追加」を選択
3. 「インストール」をタップ

### 🍎 **iPhone/iPad（Safari）**

#### 1. Safariでアクセス
- Safari ブラウザでアプリにアクセス

#### 2. 共有メニューを開く
- 画面下部の共有ボタン（□↑）をタップ

#### 3. ホーム画面に追加
1. 「ホーム画面に追加」をタップ
2. アプリ名を確認・編集
3. 「追加」をタップ

#### 4. アプリ起動
- ホーム画面のアイコンからアプリを起動

## 🔧 **スマホでの操作方法**

### 📍 **GPS位置情報の使用**

#### 1. 初回許可設定
1. 「GPS取得」ボタンをタップ
2. 「位置情報の使用を許可しますか？」で「許可」を選択
3. より正確な位置情報が必要な場合は「正確な位置情報を使用」を有効に

#### 2. GPS取得のコツ
- **屋外で使用**: 建物内では取得が困難
- **少し待つ**: 初回取得には30秒程度かかる場合あり
- **Wi-Fi/携帯データオン**: 補正情報の取得でより高精度

### 🎯 **データ入力のコツ**

#### 📝 **効率的な入力方法**
1. **調査地点名**: 定型的な名前を決めて統一
2. **日時**: アプリが自動で現在時刻を設定
3. **数値入力**: スマホの数字キーボードを活用
4. **天候選択**: 絵文字付きで直感的に選択可能

#### ⚡ **クイック操作**
- **スワイプでタブ切り替え**: データ入力→一覧→設定
- **フォームクリア**: 新しい測定点でのデータ入力時
- **オートコンプリート**: 以前の入力履歴を活用

### 📊 **データ管理**

#### 💾 **データ保存**
- **即座保存**: 入力後すぐにローカルに保存
- **自動同期**: オンライン復帰時に自動でクラウド同期
- **状態表示**: データごとに同期状態を色分け表示

#### 📈 **データ出力**
1. 「データ一覧」タブを選択
2. 「CSV出力」ボタンをタップ
3. ファイルがダウンロードフォルダに保存
4. メールやクラウドストレージで共有可能

## 🌐 **オフライン機能**

### 📱 **完全オフライン動作**
- **データ入力**: ネットワーク不要で通常通り動作
- **GPS取得**: オフラインでも位置情報取得可能
- **データ保存**: ローカル（IndexedDB）に安全に保存
- **アプリ動作**: PWAとしてオフライン起動可能

### 🔄 **同期機能**
- **自動同期**: オンライン復帰時に未同期データを自動送信
- **手動同期**: 「データ同期」ボタンで任意のタイミング実行
- **同期状態**: ヘッダーで未同期データ数を確認

## ⚙️ **設定とカスタマイズ**

### 🔧 **アプリ設定**

#### Firebase設定（オプション）
1. 「設定」タブを選択
2. Firebase設定状況を確認
3. 必要に応じて`firebase-config.js`を編集

#### データ管理
- **ローカルデータ削除**: 端末のストレージを清理
- **PWA状態確認**: インストール状況を確認

### 📋 **カスタマイズ**

#### 測定項目の追加
`index.html`のフォーム部分を編集：
```html
<div class="form-group">
    <label for="new-parameter">🧪 新しい測定項目</label>
    <input type="number" id="new-parameter" name="newParameter">
</div>
```

#### 天候選択肢の変更
select要素のオプションを編集：
```html
<option value="快晴">☀️ 快晴</option>
<option value="薄曇り">⛅ 薄曇り</option>
```

## 🚨 **トラブルシューティング**

### 📱 **スマホ固有の問題**

#### GPS が取得できない
**症状**: 「GPS取得」ボタンを押しても位置情報が取得されない

**解決方法**:
1. **位置情報サービス有効化**
   - Android: 設定 > 位置情報 > ON
   - iPhone: 設定 > プライバシーとセキュリティ > 位置情報サービス > ON

2. **ブラウザ許可確認**
   - Chrome: サイト設定 > 位置情報 > 許可
   - Safari: 設定 > Safari > 位置情報サービス > 許可

3. **屋外で再試行**
   - 建物内や地下では取得困難
   - 空の見える場所で試行

4. **ブラウザ再起動**
   - ブラウザを完全終了して再起動

#### PWAインストールできない
**症状**: インストールバナーが表示されない

**解決方法**:
1. **HTTPS環境確認**
   - `https://` または `localhost` でアクセス

2. **ブラウザ対応確認**
   - Chrome/Edge/Safari の最新版を使用

3. **手動インストール**
   - ブラウザメニューから「ホーム画面に追加」

#### アプリが重い・遅い
**症状**: タッチ操作の反応が悪い

**解決方法**:
1. **ブラウザキャッシュクリア**
   - ブラウザの設定からキャッシュ削除

2. **バックグラウンドアプリ終了**
   - 他のアプリを終了してメモリ確保

3. **端末再起動**
   - スマートフォンの再起動

### 🔧 **データ関連の問題**

#### データが保存されない
**原因と解決方法**:
1. **ストレージ容量不足**
   - 端末の空き容量を確認

2. **プライベートブラウジング**
   - 通常モードでアクセス

3. **ブラウザ設定**
   - Cookie/ローカルストレージを有効化

#### 同期が失敗する
**原因と解決方法**:
1. **ネットワーク接続確認**
   - Wi-Fi/モバイルデータの接続状況

2. **Firebase設定確認**
   - 設定タブでFirebase接続状態をチェック

3. **手動同期実行**
   - 「データ同期」ボタンで強制実行

### 📞 **サポート情報**

#### 動作確認済み環境
- **Android**: Chrome 90+, Edge 90+
- **iPhone**: Safari 14+
- **iPad**: Safari 14+

#### 推奨環境
- **OS**: Android 8+, iOS 13+
- **RAM**: 2GB以上
- **ストレージ**: 50MB以上の空き容量

## 📈 **パフォーマンス最適化**

### ⚡ **高速化のコツ**

#### スマホでの快適な使用
1. **必要時のみGPS取得**: バッテリー節約
2. **定期的なデータ同期**: 大量データの一括送信を回避
3. **キャッシュ活用**: オフライン時の高速起動

#### データ管理のベストプラクティス
1. **適切なタイミングでCSV出力**: データバックアップ
2. **定期的なローカルデータ整理**: ストレージ容量管理
3. **Firebase設定**: チーム共有が必要な場合のみ

## 🔗 **関連リンク**

- [Firebase Console](https://console.firebase.google.com/)
- [PWA デベロッパーガイド](https://web.dev/progressive-web-apps/)
- [Web GPS API リファレンス](https://developer.mozilla.org/ja/docs/Web/API/Geolocation_API)

---

## 📱 **スマホでの実際の使用例**

### 🏞️ **フィールドワークでの典型的な使用フロー**

#### 1. 現地到着
1. スマホのホーム画面からアプリを起動
2. 自動的にオフラインモードで動作開始

#### 2. データ収集
1. 「📍 GPS」ボタンで位置情報取得
2. 各測定項目を順次入力
3. 「💾 データ保存」で記録

#### 3. 移動・継続調査
1. 左右スワイプで「データ一覧」確認
2. 新しい地点で手順2を繰り返し

#### 4. 帰還後
1. Wi-Fi接続で自動同期開始
2. 「📋 CSV出力」でデータをエクスポート
3. 研究チームで共有

これでスマホ完全対応の水質調査アプリが完成しました！フィールドワークでの快適な使用をお楽しみください。 