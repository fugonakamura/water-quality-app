<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>水質調査データメモ</title>
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="style.css">
    
    <!-- PWA メタタグ -->
    <meta name="theme-color" content="#2196F3">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="水質調査">
    <meta name="mobile-web-app-capable" content="yes">
    
    <!-- アイコン設定 -->
    <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgdmlld0JveD0iMCAwIDE5MiAxOTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxOTIiIGhlaWdodD0iMTkyIiByeD0iMjQiIGZpbGw9IiMyMTk2RjMiLz4KPHA+dGV4dCB4PSI5NiIgeT0iMTA0IiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSI0OCIgZmlsbD0id2hpdGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiPuawtDwvdGV4dD4KPC9zdmc+">
    
    <!-- スマホ最適化メタタグ -->
    <meta name="format-detection" content="telephone=no">
    <meta name="msapplication-tap-highlight" content="no">
    <meta name="HandheldFriendly" content="true">
    <meta name="MobileOptimized" content="320">
    
    <!-- iOS Safari 対応 -->
    <meta name="apple-touch-fullscreen" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
</head>
<body>
    <!-- PWAインストール促進バナー -->
    <div id="install-banner" class="install-banner hidden">
        <div class="install-content">
            <span class="install-icon">📱</span>
            <span class="install-text">アプリをインストールして快適に使用</span>
            <button id="install-button" class="install-btn">インストール</button>
            <button id="install-close" class="install-close">&times;</button>
        </div>
    </div>

    <header>
        <h1>💧 水質調査データメモ</h1>
        <div class="status-bar">
            <div id="connection-status" class="status offline">
                <span class="status-icon">📶</span>
                <span id="connection-text">オフライン</span>
            </div>
            <div id="sync-status" class="status">
                <span class="sync-icon">🔄</span>
                <span>未同期: <span id="pending-count">0</span></span>
            </div>
        </div>
    </header>

    <main>
        <nav class="tab-nav">
            <button class="tab-btn active" onclick="showTab('data-entry')" type="button">
                <span class="tab-icon">✏️</span>
                <span class="tab-text">データ入力</span>
            </button>
            <button class="tab-btn" onclick="showTab('data-list')" type="button">
                <span class="tab-icon">📊</span>
                <span class="tab-text">データ一覧</span>
            </button>
            <button class="tab-btn" onclick="showTab('settings')" type="button">
                <span class="tab-icon">⚙️</span>
                <span class="tab-text">設定</span>
            </button>
        </nav>

        <!-- データ入力タブ -->
        <section id="data-entry" class="tab-content active">
            <form id="water-quality-form" novalidate>
                <div class="form-group">
                    <label for="location">🏞️ 調査地点</label>
                    <input type="text" id="location" name="location" required 
                           placeholder="例: 多摩川河口" autocomplete="off">
                </div>

                <div class="form-group">
                    <label for="coordinates">📍 座標 (緯度, 経度)</label>
                    <div class="input-with-button">
                        <input type="text" id="coordinates" name="coordinates" readonly 
                               placeholder="GPS取得または手動入力 (例: 35.6762, 139.6503)">
                        <button type="button" id="get-location" class="btn-gps">📍 GPS</button>
                    </div>
                    <div class="input-help">
                        <small>💡 GPS使用不可の場合は手動入力してください。Google Mapsで「右クリック→座標をコピー」で取得可能</small>
                    </div>
                </div>

                <div class="form-group">
                    <label for="date-time">📅 調査日時</label>
                    <input type="datetime-local" id="date-time" name="dateTime" required>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="temperature">🌡️ 水温 (°C)</label>
                        <input type="number" id="temperature" name="temperature" 
                               step="0.1" min="-10" max="50" placeholder="18.5">
                    </div>
                    <div class="form-group">
                        <label for="ph">⚗️ pH</label>
                        <input type="number" id="ph" name="ph" 
                               step="0.1" min="0" max="14" placeholder="7.2">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="dissolved-oxygen">💨 溶存酸素 (mg/L)</label>
                        <input type="number" id="dissolved-oxygen" name="dissolvedOxygen" 
                               step="0.1" min="0" placeholder="8.3">
                    </div>
                    <div class="form-group">
                        <label for="turbidity">🌫️ 濁度 (NTU)</label>
                        <input type="number" id="turbidity" name="turbidity" 
                               step="0.1" min="0" placeholder="2.1">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="conductivity">⚡ 電気伝導度 (μS/cm)</label>
                        <input type="number" id="conductivity" name="conductivity" 
                               step="1" min="0" placeholder="320">
                    </div>
                    <div class="form-group">
                        <label for="depth">🌊 水深 (m)</label>
                        <input type="number" id="depth" name="depth" 
                               step="0.1" min="0" placeholder="1.5">
                    </div>
                </div>

                <div class="form-group">
                    <label for="weather">☀️ 天候</label>
                    <select id="weather" name="weather">
                        <option value="">選択してください</option>
                        <option value="晴れ">☀️ 晴れ</option>
                        <option value="曇り">☁️ 曇り</option>
                        <option value="雨">🌧️ 雨</option>
                        <option value="雪">❄️ 雪</option>
                        <option value="霧">🌫️ 霧</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="notes">📝 メモ</label>
                    <textarea id="notes" name="notes" rows="3" 
                              placeholder="調査時の特記事項など..."></textarea>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn-primary">
                        <span class="btn-icon">💾</span>
                        <span>データ保存</span>
                    </button>
                    <button type="button" id="clear-form" class="btn-secondary">
                        <span class="btn-icon">🗑️</span>
                        <span>クリア</span>
                    </button>
                </div>
            </form>
        </section>

        <!-- データ一覧タブ -->
        <section id="data-list" class="tab-content">
            <div class="list-controls">
                <button id="sync-data" class="btn-primary">
                    <span class="btn-icon">🔄</span>
                    <span>データ同期</span>
                </button>
                <button id="export-data" class="btn-secondary">
                    <span class="btn-icon">📋</span>
                    <span>CSV出力</span>
                </button>
            </div>
            <div id="data-list-container">
                <p class="no-data">📭 データがありません</p>
            </div>
        </section>

        <!-- 設定タブ -->
        <section id="settings" class="tab-content">
            <div class="settings-group">
                <h3>🌐 環境情報</h3>
                <div class="setting-item">
                    <label for="environment-info">動作環境</label>
                    <div id="environment-info" class="status">確認中...</div>
                </div>
                <div id="codespaces-notice" class="codespaces-notice hidden">
                    <h4>📱 GitHub Codespaces環境での使用について</h4>
                    <div class="notice-content">
                        <p><strong>GPS位置情報について：</strong></p>
                        <ul>
                            <li>Codespacesでは位置情報API使用できません</li>
                            <li>手動で座標を入力してください</li>
                            <li>例: 東京駅 → <code>35.6762, 139.6503</code></li>
                            <li>Google Mapsで「右クリック → 座標をコピー」で取得可能</li>
                        </ul>
                        <p><strong>データ保存：</strong></p>
                        <ul>
                            <li>ローカルストレージに正常保存されます</li>
                            <li>CSV出力でデータを持ち出し可能</li>
                            <li>Firebase設定すればクラウド同期も対応</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="settings-group">
                <h3>☁️ Firebase設定</h3>
                <div class="setting-item">
                    <label for="firebase-status">接続状態</label>
                    <div id="firebase-status" class="status">未接続</div>
                </div>
                <button id="test-connection" class="btn-secondary">🔍 接続テスト</button>
                <div id="firebase-setup-info" class="setup-info">
                    <h4>🔧 Firebase設定方法</h4>
                    <ol>
                        <li><a href="https://console.firebase.google.com/" target="_blank">Firebase Console</a>でプロジェクト作成</li>
                        <li>「ウェブアプリを追加」で設定取得</li>
                        <li><code>firebase-config.js</code>に設定値を入力</li>
                        <li>Firestoreデータベースを有効化</li>
                    </ol>
                    <p class="info-note">※ Firebase未設定でもオフライン機能は完全動作します</p>
                </div>
            </div>

            <div class="settings-group">
                <h3>📱 アプリ情報</h3>
                <div class="setting-item">
                    <span>バージョン</span>
                    <span>1.0.0</span>
                </div>
                <div class="setting-item">
                    <span>PWA対応</span>
                    <span id="pwa-status">確認中...</span>
                </div>
                <div class="setting-item">
                    <span>GPS機能</span>
                    <span id="gps-status">確認中...</span>
                </div>
                <div class="setting-item">
                    <span>データ件数</span>
                    <span id="data-count">0件</span>
                </div>
            </div>

            <div class="settings-group">
                <h3>🗂️ データ管理</h3>
                <button id="clear-local-data" class="btn-warning">
                    <span class="btn-icon">⚠️</span>
                    <span>ローカルデータ削除</span>
                </button>
                <p class="warning-text">※ 削除したデータは復元できません</p>
            </div>
        </section>
    </main>

    <!-- ローディングオーバーレイ -->
    <div id="loading-overlay" class="loading-overlay hidden">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <p id="loading-message">処理中...</p>
        </div>
    </div>

    <!-- トースト通知エリア -->
    <div id="toast-container" class="toast-container"></div>

    <footer>
        <p>&copy; 2024 水質調査データメモ - フィールドワーク支援アプリ</p>
    </footer>

    <!-- Scripts -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js" type="module"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js" type="module"></script>
    <script src="firebase-config.js" type="module"></script>
    <script src="app.js" type="module"></script>
</body>
</html> 